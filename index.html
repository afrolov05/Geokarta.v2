<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Geo Cashback MVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root {
      --bg-main: #05060a;
      --bg-card: #15161c;
      --bg-card-soft: #1f2027;
      --bg-chip: #262730;
      --bg-tab: #1f2027;
      --txt-main: #ffffff;
      --txt-soft: #c4c4d0;
      --txt-muted: #8f90a0;
      --radius-xl: 26px;

      --accent-red: #ff3859;
      --accent-orange: #ff9f30;
      --accent-lime: #29d9a6;
      --accent-purple: #7c5cff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      font-family: system-ui, -apple-system, "SF Pro Display", sans-serif;
    }

    body {
      background: var(--bg-main);
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      color: var(--txt-main);
    }

    .app-shell {
      width: 100%;
      max-width: 430px;
      height: 100vh;
      position: relative;
      overflow: hidden;
      background: var(--bg-main);
    }

    @media (min-width: 768px) {
      .app-shell {
        margin: 16px auto;
        height: calc(100vh - 32px);
        border-radius: 30px;
        box-shadow: 0 18px 45px rgba(0,0,0,0.7);
      }
    }

    #map {
      position: absolute;
      inset: 0;
      z-index: 1;
    }

    /* --- Bottom panel --- */

    .bottom-panel {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px 12px 16px;
      z-index: 3;
      background: linear-gradient(
        to top,
        rgba(5, 6, 10, 0.98),
        rgba(5, 6, 10, 0.7),
        transparent
      );
      pointer-events: none;
    }

    .bottom-inner {
      pointer-events: auto;
    }

    /* MAIN UI (—Ç–∞–±—ã, –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä—ã, –≥–∏–¥) */
    #mainUI {
      display: block;
    }

    /* HEAT UI (—Å—Ä–µ–¥–Ω–∏–π –∫—ç—à–±—ç–∫ –ø–æ —Ä–∞–π–æ–Ω–∞–º) */
    #heatUI {
      display: none;
      background: var(--bg-card);
      border-radius: 22px;
      padding: 14px 16px 16px;
      border: 1px solid rgba(255,255,255,0.08);
    }

    .heat-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .heat-back {
      font-size: 20px;
      cursor: pointer;
      padding: 4px 6px 4px 0;
    }

    .heat-title {
      font-size: 16px;
      font-weight: 700;
    }

    .heat-subtitle {
      font-size: 12px;
      color: var(--txt-muted);
      margin-bottom: 2px;
      margin-left: 28px;
    }

    /* tabs */

    .tabs-row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .tab {
      flex: 1;
      text-align: center;
      background: var(--bg-tab);
      color: var(--txt-soft);
      padding: 10px 6px;
      border-radius: 16px;
      font-size: 13px;
      cursor: pointer;
      font-weight: 500;
    }

    .tab.active {
      background: linear-gradient(145deg, #ff7b5f, #ff2140);
      color: #fff;
      font-weight: 700;
    }

    /* search */

    .search-row {
      display: flex;
      align-items: center;
      background: #1c1d24;
      padding: 10px 12px;
      border-radius: 14px;
      margin-bottom: 10px;
    }

    .search-row span {
      margin-right: 6px;
      opacity: 0.85;
    }

    .search-row input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: #fff;
      font-size: 14px;
    }

    /* chips */

    .categories-row {
      display: flex;
      gap: 6px;
      overflow-x: auto;
      scrollbar-width: none;
      margin-bottom: 10px;
    }

    .categories-row::-webkit-scrollbar { display: none; }

    .chip {
      padding: 6px 12px;
      border-radius: 999px;
      background: var(--bg-chip);
      color: var(--txt-soft);
      border: 1px solid rgba(255,255,255,0.1);
      font-size: 12px;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .chip.active {
      background: linear-gradient(145deg, #ff7b5f, #ff2140);
      border: none;
      color: #fff;
      font-weight: 600;
    }

    .chip-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #fff3;
    }

    /* banner */

    .banner {
      background: #46b6ff;
      color: #05253c;
      border-radius: 18px;
      padding: 12px 14px;
      font-size: 13px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      cursor: pointer;
      font-weight: 500;
    }

    .banner-title {
      font-weight: 700;
      margin-bottom: 2px;
    }

    .banner-arrow {
      font-size: 20px;
      margin-left: 8px;
    }

    /* guide */

    .card-guide {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      padding: 16px 18px;
      border: 1px solid rgba(255,255,255,0.07);
    }

    .guide-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .guide-subtitle {
      font-size: 12px;
      color: var(--txt-muted);
      margin-bottom: 10px;
    }

    .guide-steps {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 12px;
    }

    .step {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: #1d1e25;
      color: var(--txt-soft);
      border: 1px solid rgba(255,255,255,0.15);
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      font-size: 12px;
    }

    .step.active {
      background: linear-gradient(145deg, #ff7b5f, #ff2140);
      color: #fff;
      border: none;
    }

    .step-line {
      flex: 1;
      height: 1.5px;
      background: rgba(255,255,255,0.15);
    }

    .guide-place-card {
      background: var(--bg-card-soft);
      border-radius: 18px;
      padding: 12px 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .guide-place-main {
      font-size: 13px;
    }

    .guide-place-name {
      font-weight: 600;
      margin-bottom: 2px;
      color: var(--txt-main);
    }

    .guide-place-address {
      font-size: 11px;
      color: var(--txt-soft);
    }

    .guide-place-meta {
      text-align: right;
      font-size: 11px;
      color: var(--txt-soft);
    }

    .tag {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      background: #343542;
      margin-bottom: 4px;
    }

    /* ========== DETAIL CARD ========== */

    .place-detail-wrapper {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 0 12px 22px;
      z-index: 4;
      display: none;
      background: linear-gradient(
        to top,
        rgba(5, 6, 10, 0.95),
        rgba(5, 6, 10, 0.6),
        transparent
      );
      pointer-events: none;
    }

    .place-detail {
      background: #121318;
      border-radius: 22px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.08);
      opacity: 0;
      transform: translateY(40px);
      transition: 0.28s ease;
      pointer-events: auto;
      box-shadow: 0 8px 26px rgba(0,0,0,0.4);
    }

    .place-detail.show {
      opacity: 1;
      transform: translateY(0);
    }

    .detail-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
    }

    .detail-logo {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      background: #20212a;
      object-fit: contain;
      padding: 6px;
      border: 1px solid rgba(255,255,255,0.05);
    }

    .detail-close {
      margin-left: auto;
      font-size: 28px;
      opacity: 0.7;
      cursor: pointer;
      color: #ffffff;
    }

    .detail-title {
      font-size: 18px;
      font-weight: 700;
      color: #ffffff;
    }

    .detail-category {
      display: inline-block;
      padding: 4px 12px;
      margin-top: 4px;
      font-size: 11px;
      font-weight: 700;
      border-radius: 999px;
      color: #000;
    }

    .detail-meta {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .detail-row {
      font-size: 14px;
      color: var(--txt-soft);
    }

    .detail-badges {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .detail-badge {
      background: #1d1e25;
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 10px;
      color: #fff;
      border: 1px solid rgba(255,255,255,0.06);
      white-space: nowrap;
    }

    /* Locate button */
    .btn-locate {
      position: absolute;
      right: 16px;
      bottom: 210px;
      width: 44px;
      height: 44px;
      border-radius: 999px;
      z-index: 3;
      background: radial-gradient(circle at 30% 0, #4bffe5, #1b1c24);
      border: none;
      cursor: pointer;
      font-size: 18px;
    }

    /* ========== NEARBY LIST ========== */

    .nearby-panel {
      display: none;
      background: var(--bg-card);
      padding: 16px 14px 30px;
      border-radius: 22px 22px 0 0;
      border: 1px solid rgba(255,255,255,0.07);
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 4;
      max-height: 65vh;
      overflow-y: auto;
    }

    .nearby-title-row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      gap: 6px;
    }

    .nearby-back {
      font-size: 20px;
      cursor: pointer;
      padding-right: 4px;
    }

    .nearby-title {
      font-size: 18px;
      font-weight: 700;
    }

    .nearby-item {
      display: flex;
      align-items: center;
      background: #202128;
      padding: 12px;
      border-radius: 16px;
      margin-bottom: 10px;
      cursor: pointer;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .nearby-icon {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      background: #fff1;
      margin-right: 12px;
      object-fit: contain;
    }

    .nearby-name {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .nearby-address {
      font-size: 12px;
      color: var(--txt-soft);
    }

    .nearby-distance {
      margin-left: auto;
      font-size: 13px;
      font-weight: 600;
      color: #fff;
    }

  </style>
</head>

<body>
<div class="app-shell">

  <!-- MAP -->
  <div id="map"></div>

  <!-- GEO BUTTON -->
  <button id="btnLocate" class="btn-locate">üìç</button>

  <!-- PANEL: NEARBY LIST -->
  <div class="nearby-panel" id="nearbyPanel">
    <div class="nearby-title-row">
      <div class="nearby-back" id="nearbyBackBtn">‚Üê</div>
      <div class="nearby-title">–†—è–¥–æ–º —Å –≤–∞–º–∏</div>
    </div>
    <div style="font-size:12px;color:#c4c4d0;margin-bottom:8px;">
      –ú–µ—Å—Ç–∞ –≤ —Ä–∞–¥–∏—É—Å–µ 3 –∫–º –æ—Ç –≤–∞—à–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
    </div>
    <div id="nearbyList"></div>
  </div>

  <!-- BOTTOM PANEL -->
  <div class="bottom-panel">
    <div class="bottom-inner">

      <!-- MAIN UI (—Ç–∞–±—ã, –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä—ã, –≥–∏–¥) -->
      <div id="mainUI">
        <!-- TABS -->
        <div class="tabs-row">
          <div class="tab active" data-tab="cashback">–í–∞—à –∫—ç—à–±—ç–∫</div>
          <div class="tab" data-tab="nearby">–†—è–¥–æ–º —Å –≤–∞–º–∏</div>
        </div>

        <!-- SEARCH -->
        <div class="search-row" id="searchRow">
          <span>üîç</span>
          <input id="searchInput" placeholder="–ü–æ–∏—Å–∫">
        </div>

        <!-- CATEGORY CHIPS -->
        <div class="categories-row" id="categoriesRow"></div>

        <!-- RAIN BANNER -->
        <div class="banner" id="bannerRain">
          <div style="display:flex;align-items:flex-start;">
            <div class="banner-icon">üíß</div>
            <div>
              <div class="banner-title">–û–∂–∏–¥–∞—é—Ç—Å—è –æ—Å–∞–¥–∫–∏ –≤ –≤–∏–¥–µ –∫—ç—à–±—ç–∫–∞</div>
              <div class="banner-text">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ä–µ–¥–Ω–∏–π –∫—ç—à–±—ç–∫ –ø–æ —Ä–∞–π–æ–Ω–∞–º</div>
            </div>
          </div>
          <div class="banner-arrow">‚Ä∫</div>
        </div>

        <!-- GUIDE -->
        <div class="card-guide" id="guideCard">
          <div class="guide-title" id="guideTitle">–ì–∏–¥ –ø–æ —Ä–∞–π–æ–Ω—É</div>
          <div class="guide-subtitle" id="guideSubtitle"></div>

          <div class="guide-steps" id="guideSteps"></div>

          <div class="guide-place-card" id="guidePlaceCard">
            <div class="guide-place-main">
              <div class="guide-place-name" id="placeName"></div>
              <div class="guide-place-address" id="placeAddress"></div>
            </div>
            <div class="guide-place-meta">
              <div class="tag" id="placeCategory"></div>
              <div id="placeDistance"></div>
              <div id="placeAvgCheck"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- HEAT UI (—Å—Ä–µ–¥–Ω–∏–π –∫—ç—à–±—ç–∫ –ø–æ —Ä–∞–π–æ–Ω–∞–º) -->
      <div id="heatUI">
        <div class="heat-header">
          <div class="heat-back" id="heatBackBtn">‚Üê</div>
          <div class="heat-title">–°—Ä–µ–¥–Ω–∏–π –∫—ç—à–±—ç–∫ –ø–æ —Ä–∞–π–æ–Ω–∞–º</div>
        </div>
        <div class="heat-subtitle">
          –ö–ª–∏–∫–∞–π –ø–æ –∫—Ä—É–≥–∞–º –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ä–µ–¥–Ω–∏–π –∫—ç—à–±—ç–∫.
        </div>
      </div>

    </div>
  </div>

  <!-- DETAIL CARD -->
  <div class="place-detail-wrapper" id="placeDetailWrap">
    <div class="place-detail" id="placeDetail">

      <div class="detail-header">
        <img id="detailLogo" class="detail-logo" />
        <div>
          <div class="detail-title" id="detailTitle"></div>
          <div class="detail-category" id="detailCategory"></div>
        </div>
        <div id="detailClose" class="detail-close">√ó</div>
      </div>

      <div class="detail-meta">
        <div class="detail-row" id="detailAddress"></div>

        <div class="detail-badges">
          <div class="detail-badge">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫: <span id="detailAvgCheck"></span></div>
          <div class="detail-badge">–ö—ç—à–±—ç–∫: <span id="detailCashback"></span>%</div>
        </div>
      </div>

    </div>
  </div>

</div>

<script>
/* ========= –î–ê–ù–ù–´–ï –í–ù–£–¢–†–ò –§–ê–ô–õ–ê ========= */

const ALL_PLACES = [
  {"id":1,"brand":"–®–æ–∫–æ–ª–∞–¥–Ω–∏—Ü–∞","name":"–®–æ–∫–æ–ª–∞–¥–Ω–∏—Ü–∞","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.74719,"lon":37.65403,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 1","avgCheck":850,"cashback":5},
  {"id":2,"brand":"–í–µ–ª–æ–°—Ç—Ä–∞–Ω–∞","name":"–í–µ–ª–æ–°—Ç—Ä–∞–Ω–∞","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.84441,"lon":37.70526,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 2","avgCheck":7000,"cashback":5},
  {"id":3,"brand":"–§–æ—Ä–º—É–ª–∞ –ö–∏–Ω–æ","name":"–§–æ—Ä–º—É–ª–∞ –ö–∏–Ω–æ","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.83721,"lon":37.77184,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 3","avgCheck":600,"cashback":4},
  {"id":4,"brand":"Shell","name":"Shell","category":"–ê–ó–°","lat":55.96685,"lon":37.50194,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 4","avgCheck":2020,"cashback":3},
  {"id":5,"brand":"–°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫","name":"–°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.94202,"lon":37.41482,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 5","avgCheck":700,"cashback":6},
  {"id":6,"brand":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","name":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.67523,"lon":37.82164,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 6","avgCheck":4000,"cashback":4},
  {"id":7,"brand":"–°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫","name":"–°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.92658,"lon":37.89349,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 7","avgCheck":700,"cashback":3},
  {"id":8,"brand":"KFC","name":"KFC","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.99122,"lon":37.41623,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 8","avgCheck":600,"cashback":5},
  {"id":9,"brand":"KFC","name":"KFC","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.60972,"lon":37.51596,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 9","avgCheck":600,"cashback":6},
  {"id":10,"brand":"–°–ø–æ—Ä—Ç –î–µ–ø–æ","name":"–°–ø–æ—Ä—Ç –î–µ–ø–æ","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.87062,"lon":37.84756,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 10","avgCheck":3800,"cashback":4},
  {"id":11,"brand":"–õ—É–∫–æ–π–ª","name":"–õ—É–∫–æ–π–ª","category":"–ê–ó–°","lat":55.75208,"lon":37.59299,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 11","avgCheck":2020,"cashback":6},
  {"id":12,"brand":"Starbucks","name":"Starbucks","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.77379,"lon":37.40717,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 12","avgCheck":450,"cashback":6},
  {"id":13,"brand":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","name":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","category":"–ê–ó–°","lat":55.78834,"lon":37.72705,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 13","avgCheck":2020,"cashback":7},
  {"id":14,"brand":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","name":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.80784,"lon":37.43366,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 14","avgCheck":1500,"cashback":6},
  {"id":15,"brand":"–õ—É–∫–æ–π–ª","name":"–õ—É–∫–æ–π–ª","category":"–ê–ó–°","lat":55.6194,"lon":37.44418,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 15","avgCheck":2020,"cashback":3},
  {"id":16,"brand":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","name":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.69541,"lon":37.67718,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 16","avgCheck":1500,"cashback":4},
  {"id":17,"brand":"–ö–∞–Ω—Ç","name":"–ö–∞–Ω—Ç","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.88459,"lon":37.65297,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 17","avgCheck":4500,"cashback":5},
  {"id":18,"brand":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","name":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","category":"–ê–ó–°","lat":55.90606,"lon":37.79985,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 18","avgCheck":2020,"cashback":4},
  {"id":19,"brand":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","name":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.78094,"lon":37.7217,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 19","avgCheck":4000,"cashback":7},
  {"id":20,"brand":"Burger King","name":"Burger King","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.76862,"lon":37.58325,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 20","avgCheck":650,"cashback":7},
  {"id":21,"brand":"–ú–æ—Å–≥–æ—Ä–ø–∞—Ä–∫","name":"–ú–æ—Å–≥–æ—Ä–ø–∞—Ä–∫","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.74219,"lon":37.68789,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 21","avgCheck":500,"cashback":4},
  {"id":22,"brand":"Shell","name":"Shell","category":"–ê–ó–°","lat":55.89621,"lon":37.81064,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 22","avgCheck":2020,"cashback":6},
  {"id":23,"brand":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","name":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","category":"–ê–ó–°","lat":55.71096,"lon":37.6288,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 23","avgCheck":2020,"cashback":6},
  {"id":24,"brand":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","name":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.88279,"lon":37.7872,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 24","avgCheck":1500,"cashback":5},
  {"id":25,"brand":"–ê–ª—å–º–∞","name":"–ê–ª—å–º–∞","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.8595,"lon":37.56764,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 25","avgCheck":2200,"cashback":5},
  {"id":26,"brand":"KFC","name":"KFC","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.60546,"lon":37.55133,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 26","avgCheck":600,"cashback":7},
  {"id":27,"brand":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","name":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.91827,"lon":37.58791,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 27","avgCheck":1500,"cashback":6},
  {"id":28,"brand":"Burger King","name":"Burger King","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.88956,"lon":37.83997,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 28","avgCheck":650,"cashback":5},
  {"id":29,"brand":"–ú–æ—Å–≥–æ—Ä–ø–∞—Ä–∫","name":"–ú–æ—Å–≥–æ—Ä–ø–∞—Ä–∫","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.62848,"lon":37.55766,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 29","avgCheck":500,"cashback":4},
  {"id":30,"brand":"–ï–ö–ê","name":"–ï–ö–ê","category":"–ê–ó–°","lat":55.9075,"lon":37.40787,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 30","avgCheck":2020,"cashback":3},
  {"id":31,"brand":"–í–µ–ª–æ–°—Ç—Ä–∞–Ω–∞","name":"–í–µ–ª–æ–°—Ç—Ä–∞–Ω–∞","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.9347,"lon":37.87501,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 31","avgCheck":7000,"cashback":7},
  {"id":32,"brand":"–ú–æ—Å–≥–æ—Ä–ø–∞—Ä–∫","name":"–ú–æ—Å–≥–æ—Ä–ø–∞—Ä–∫","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.88218,"lon":37.46162,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 32","avgCheck":500,"cashback":6},
  {"id":33,"brand":"–õ—É–∫–æ–π–ª","name":"–õ—É–∫–æ–π–ª","category":"–ê–ó–°","lat":55.91485,"lon":37.57279,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 33","avgCheck":2020,"cashback":7},
  {"id":34,"brand":"–õ—É–∫–æ–π–ª","name":"–õ—É–∫–æ–π–ª","category":"–ê–ó–°","lat":55.98158,"lon":37.7881,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 34","avgCheck":2020,"cashback":7},
  {"id":35,"brand":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","name":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.79953,"lon":37.68671,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 35","avgCheck":1500,"cashback":7},
  {"id":36,"brand":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","name":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.66692,"lon":37.5454,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 36","avgCheck":4000,"cashback":7},
  {"id":37,"brand":"KFC","name":"KFC","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.77743,"lon":37.44569,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 37","avgCheck":600,"cashback":3},
  {"id":38,"brand":"–õ—É–∫–æ–π–ª","name":"–õ—É–∫–æ–π–ª","category":"–ê–ó–°","lat":55.66665,"lon":37.80496,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 38","avgCheck":2020,"cashback":5},
  {"id":39,"brand":"–®–æ–∫–æ–ª–∞–¥–Ω–∏—Ü–∞","name":"–®–æ–∫–æ–ª–∞–¥–Ω–∏—Ü–∞","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.85811,"lon":37.55484,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 39","avgCheck":850,"cashback":3},
  {"id":40,"brand":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","name":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","category":"–ê–ó–°","lat":55.67211,"lon":37.84365,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 40","avgCheck":2020,"cashback":4},
  {"id":41,"brand":"Osteria Mario","name":"Osteria Mario","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.64138,"lon":37.88375,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 41","avgCheck":1800,"cashback":3},
  {"id":42,"brand":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","name":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","category":"–ê–ó–°","lat":55.96711,"lon":37.6192,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 42","avgCheck":2020,"cashback":7},
  {"id":43,"brand":"–ö–∞—Ç–æ–∫ –í–î–ù–•","name":"–ö–∞—Ç–æ–∫ –í–î–ù–•","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.86432,"lon":37.41067,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 43","avgCheck":900,"cashback":5},
  {"id":44,"brand":"–°–ø–æ—Ä—Ç –î–µ–ø–æ","name":"–°–ø–æ—Ä—Ç –î–µ–ø–æ","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.6623,"lon":37.78642,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 44","avgCheck":3800,"cashback":7},
  {"id":45,"brand":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","name":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.66237,"lon":37.74488,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 45","avgCheck":1500,"cashback":6},
  {"id":46,"brand":"–ï–ö–ê","name":"–ï–ö–ê","category":"–ê–ó–°","lat":55.89744,"lon":37.71757,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 46","avgCheck":2020,"cashback":6},
  {"id":47,"brand":"–í–µ–ª–æ–°—Ç—Ä–∞–Ω–∞","name":"–í–µ–ª–æ–°—Ç—Ä–∞–Ω–∞","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.9636,"lon":37.67741,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 47","avgCheck":7000,"cashback":6},
  {"id":48,"brand":"–¢—Ä–∏–∞–ª-–°–ø–æ—Ä—Ç","name":"–¢—Ä–∏–∞–ª-–°–ø–æ—Ä—Ç","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.95819,"lon":37.57506,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 48","avgCheck":5000,"cashback":4},
  {"id":49,"brand":"–ö–∞–Ω—Ç","name":"–ö–∞–Ω—Ç","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.87406,"lon":37.42707,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 49","avgCheck":4500,"cashback":7},
  {"id":50,"brand":"–ö–∞—Ç–æ–∫ –í–î–ù–•","name":"–ö–∞—Ç–æ–∫ –í–î–ù–•","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.96744,"lon":37.6843,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 50","avgCheck":900,"cashback":6},
  {"id":51,"brand":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","name":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.66114,"lon":37.48603,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 51","avgCheck":1500,"cashback":4},
  {"id":52,"brand":"–í–µ–ª–æ–°—Ç—Ä–∞–Ω–∞","name":"–í–µ–ª–æ–°—Ç—Ä–∞–Ω–∞","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.62792,"lon":37.74085,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 52","avgCheck":7000,"cashback":6},
  {"id":53,"brand":"–°–ø–æ—Ä—Ç –î–µ–ø–æ","name":"–°–ø–æ—Ä—Ç –î–µ–ø–æ","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.66107,"lon":37.64891,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 53","avgCheck":3800,"cashback":3},
  {"id":54,"brand":"–ï–ö–ê","name":"–ï–ö–ê","category":"–ê–ó–°","lat":55.98639,"lon":37.84944,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 54","avgCheck":2020,"cashback":7},
  {"id":55,"brand":"–ê–ª—å–º–∞","name":"–ê–ª—å–º–∞","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.87177,"lon":37.52972,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 55","avgCheck":2200,"cashback":7},
  {"id":56,"brand":"–ê–ª—å–º–∞","name":"–ê–ª—å–º–∞","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.76765,"lon":37.58265,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 56","avgCheck":2200,"cashback":5},
  {"id":57,"brand":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","name":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","category":"–ê–ó–°","lat":55.9221,"lon":37.85748,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 57","avgCheck":2020,"cashback":6},
  {"id":58,"brand":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","name":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","category":"–ê–ó–°","lat":55.6867,"lon":37.45049,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 58","avgCheck":2020,"cashback":5},
  {"id":59,"brand":"KFC","name":"KFC","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.99612,"lon":37.71737,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 59","avgCheck":600,"cashback":4},
  {"id":60,"brand":"–ö–∞—Ä–æ","name":"–ö–∞—Ä–æ","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.93482,"lon":37.66965,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 60","avgCheck":650,"cashback":7},
  {"id":61,"brand":"–ö–∞—Ç–æ–∫ –í–î–ù–•","name":"–ö–∞—Ç–æ–∫ –í–î–ù–•","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.83058,"lon":37.58464,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 61","avgCheck":900,"cashback":3},
  {"id":62,"brand":"Osteria Mario","name":"Osteria Mario","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.92936,"lon":37.82846,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 62","avgCheck":1800,"cashback":7},
  {"id":63,"brand":"Starbucks","name":"Starbucks","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.63447,"lon":37.47159,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 63","avgCheck":450,"cashback":6},
  {"id":64,"brand":"–ö–∞–Ω—Ç","name":"–ö–∞–Ω—Ç","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.73813,"lon":37.74014,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 64","avgCheck":4500,"cashback":4},
  {"id":65,"brand":"–ö–∞–Ω—Ç","name":"–ö–∞–Ω—Ç","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.70989,"lon":37.74994,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 65","avgCheck":4500,"cashback":6},
  {"id":66,"brand":"Osteria Mario","name":"Osteria Mario","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.66515,"lon":37.61403,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 66","avgCheck":1800,"cashback":6},
  {"id":67,"brand":"Forward","name":"Forward","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.89249,"lon":37.49413,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 67","avgCheck":3500,"cashback":4},
  {"id":68,"brand":"–ö–∞—Ç–æ–∫ –í–î–ù–•","name":"–ö–∞—Ç–æ–∫ –í–î–ù–•","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.95664,"lon":37.68834,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 68","avgCheck":900,"cashback":5},
  {"id":69,"brand":"–ö–∞—Ç–æ–∫ –í–î–ù–•","name":"–ö–∞—Ç–æ–∫ –í–î–ù–•","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.91336,"lon":37.82298,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 69","avgCheck":900,"cashback":3},
  {"id":70,"brand":"Osteria Mario","name":"Osteria Mario","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.83,"lon":37.60257,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 70","avgCheck":1800,"cashback":6},
  {"id":71,"brand":"Starbucks","name":"Starbucks","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.89733,"lon":37.71447,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 71","avgCheck":450,"cashback":4},
  {"id":72,"brand":"–§–æ—Ä–º—É–ª–∞ –ö–∏–Ω–æ","name":"–§–æ—Ä–º—É–ª–∞ –ö–∏–Ω–æ","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.65764,"lon":37.57901,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 72","avgCheck":600,"cashback":6},
  {"id":73,"brand":"Forward","name":"Forward","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.97514,"lon":37.71518,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 73","avgCheck":3500,"cashback":4},
  {"id":74,"brand":"–¢—Ä–∏–∞–ª-–°–ø–æ—Ä—Ç","name":"–¢—Ä–∏–∞–ª-–°–ø–æ—Ä—Ç","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.91325,"lon":37.60669,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 74","avgCheck":5000,"cashback":5},
  {"id":75,"brand":"–ö–∞–Ω—Ç","name":"–ö–∞–Ω—Ç","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.75663,"lon":37.48961,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 75","avgCheck":4500,"cashback":4},
  {"id":76,"brand":"–ö–∞—Ä–æ","name":"–ö–∞—Ä–æ","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.60318,"lon":37.59298,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 76","avgCheck":650,"cashback":4},
  {"id":77,"brand":"Shell","name":"Shell","category":"–ê–ó–°","lat":55.78222,"lon":37.88475,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 77","avgCheck":2020,"cashback":7},
  {"id":78,"brand":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","name":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.89318,"lon":37.89729,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 78","avgCheck":4000,"cashback":5},
  {"id":79,"brand":"–¢—Ä–∏–∞–ª-–°–ø–æ—Ä—Ç","name":"–¢—Ä–∏–∞–ª-–°–ø–æ—Ä—Ç","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.67947,"lon":37.68167,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 79","avgCheck":5000,"cashback":3},
  {"id":80,"brand":"–ê–ª—å–º–∞","name":"–ê–ª—å–º–∞","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.91155,"lon":37.53912,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 80","avgCheck":2200,"cashback":7},
  {"id":81,"brand":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","name":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.74739,"lon":37.83887,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 81","avgCheck":4000,"cashback":7},
  {"id":82,"brand":"–§–æ—Ä–º—É–ª–∞ –ö–∏–Ω–æ","name":"–§–æ—Ä–º—É–ª–∞ –ö–∏–Ω–æ","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.67556,"lon":37.41928,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 82","avgCheck":600,"cashback":6},
  {"id":83,"brand":"–°–ø–æ—Ä—Ç –î–µ–ø–æ","name":"–°–ø–æ—Ä—Ç –î–µ–ø–æ","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.67474,"lon":37.44509,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 83","avgCheck":3800,"cashback":5},
  {"id":84,"brand":"–¢—Ä–∏–∞–ª-–°–ø–æ—Ä—Ç","name":"–¢—Ä–∏–∞–ª-–°–ø–æ—Ä—Ç","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.62084,"lon":37.5285,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 84","avgCheck":5000,"cashback":5},
  {"id":85,"brand":"Shell","name":"Shell","category":"–ê–ó–°","lat":55.7035,"lon":37.58098,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 85","avgCheck":2020,"cashback":5},
  {"id":86,"brand":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","name":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.65146,"lon":37.51393,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 86","avgCheck":4000,"cashback":4},
  {"id":87,"brand":"–ö–∞–Ω—Ç","name":"–ö–∞–Ω—Ç","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.74927,"lon":37.75269,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 87","avgCheck":4500,"cashback":6},
  {"id":88,"brand":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","name":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","category":"–ê–ó–°","lat":55.90906,"lon":37.48564,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 88","avgCheck":2020,"cashback":7},
  {"id":89,"brand":"–§–æ—Ä–º—É–ª–∞ –ö–∏–Ω–æ","name":"–§–æ—Ä–º—É–ª–∞ –ö–∏–Ω–æ","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.64748,"lon":37.84061,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 89","avgCheck":600,"cashback":5},
  {"id":90,"brand":"–ö–∞—Ä–æ","name":"–ö–∞—Ä–æ","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.96501,"lon":37.57965,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 90","avgCheck":650,"cashback":3},
  {"id":91,"brand":"–§–æ—Ä–º—É–ª–∞ –ö–∏–Ω–æ","name":"–§–æ—Ä–º—É–ª–∞ –ö–∏–Ω–æ","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.86941,"lon":37.44329,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 91","avgCheck":600,"cashback":7},
  {"id":92,"brand":"KFC","name":"KFC","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.75034,"lon":37.80946,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 92","avgCheck":600,"cashback":3},
  {"id":93,"brand":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","name":"–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.77895,"lon":37.66571,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 93","avgCheck":4000,"cashback":6},
  {"id":94,"brand":"–ö–∞–Ω—Ç","name":"–ö–∞–Ω—Ç","category":"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã","lat":55.95515,"lon":37.68849,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 94","avgCheck":4500,"cashback":5},
  {"id":95,"brand":"–õ—É–∫–æ–π–ª","name":"–õ—É–∫–æ–π–ª","category":"–ê–ó–°","lat":55.91268,"lon":37.44999,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 95","avgCheck":2020,"cashback":7},
  {"id":96,"brand":"–°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫","name":"–°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.75343,"lon":37.72382,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 96","avgCheck":700,"cashback":6},
  {"id":97,"brand":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","name":"–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å","category":"–ê–ó–°","lat":55.70452,"lon":37.48292,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 97","avgCheck":2020,"cashback":7},
  {"id":98,"brand":"KFC","name":"KFC","category":"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ","lat":55.66602,"lon":37.84776,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 98","avgCheck":600,"cashback":4},
  {"id":99,"brand":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","name":"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.92797,"lon":37.76096,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 99","avgCheck":1500,"cashback":4},
  {"id":100,"brand":"–ö–∞—Ç–æ–∫ –í–î–ù–•","name":"–ö–∞—Ç–æ–∫ –í–î–ù–•","category":"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","lat":55.94378,"lon":37.47177,"address":"–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å 100","avgCheck":900,"cashback":3}
];

const BRAND_LOGOS = {
  "–õ—É–∫–æ–π–ª": "logos/–ª—É–∫–æ–π–ª.png",
  "–ì–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å": "logos/–≥–∞–∑–ø—Ä–æ–º–Ω–µ—Ñ—Ç—å.png",
  "–ï–ö–ê": "logos/–µ–∫–∞.png",
  "–¢–∞—Ç–Ω–µ—Ñ—Ç—å": "logos/—Ç–∞—Ç–Ω–µ—Ñ—Ç—å.png",

  "–®–æ–∫–æ–ª–∞–¥–Ω–∏—Ü–∞": "logos/—à–æ–∫–æ–ª–∞–¥–Ω–∏—Ü–∞.png",
  "–ú—É-–ú—É": "logos/–º—É–º—É.png",
  "Osteria Mario": "logos/osteria.png",
  "–ê–ª—å–º–∞": "logos/alma.png",
  "KFC": "logos/kfc.png",
  "Burger King": "logos/bk.png",
  "Starbucks": "logos/starbucks.png",

  "–°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä": "logos/—Å–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä.png",
  "–¢—Ä–∏–∞–ª-–°–ø–æ—Ä—Ç": "logos/—Ç—Ä–∏–∞–ª—Å–ø–æ—Ä—Ç.png",
  "–í–µ–ª–æ–°—Ç—Ä–∞–Ω–∞": "logos/–≤–µ–ª–æ—Å—Ç—Ä–∞–Ω–∞.png",
  "–ö–∞–Ω—Ç": "logos/–∫–∞–Ω—Ç.png",
  "Forward": "logos/forward.png",
  "–°–ø–æ—Ä—Ç –î–µ–ø–æ": "logos/—Å–ø–æ—Ä—Ç–¥–µ–ø–æ.png",

  "–§–æ—Ä–º—É–ª–∞ –ö–∏–Ω–æ": "logos/—Ñ–æ—Ä–º—É–ª–∞–∫–∏–Ω–æ.png",
  "–ö–∞—Ä–æ": "logos/–∫–∞—Ä–æ.png",
  "–°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫": "logos/—Å–∏–Ω–µ–º–∞–ø–∞—Ä–∫.png",
  "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –î–µ—Ç—Å–∫–∏–π –ú–∏—Ä": "logos/—Ü–¥–º.png",
  "–ö–∞—Ç–æ–∫ –í–î–ù–•": "logos/–∫–∞—Ç–æ–∫–≤–¥–Ω—Ö.png",
  "–ú–æ—Å–≥–æ—Ä–ø–∞—Ä–∫": "logos/–º–æ—Å–≥–æ—Ä–ø–∞—Ä–∫.png"
};

const AVERAGE_ZONES = [
  {"name":"–¶–ê–û ‚Äî –¢–≤–µ—Ä—Å–∫–æ–π","lat":55.7652,"lon":37.605,"value":38},
  {"name":"–¶–ê–û ‚Äî –ü—Ä–µ—Å–Ω–µ–Ω—Å–∫–∏–π","lat":55.7601,"lon":37.5547,"value":36},
  {"name":"–¶–ê–û ‚Äî –ë–∞—Å–º–∞–Ω–Ω—ã–π","lat":55.7665,"lon":37.6806,"value":34},
  {"name":"–¶–ê–û ‚Äî –¢–∞–≥–∞–Ω—Å–∫–∏–π","lat":55.7323,"lon":37.6659,"value":33},
  {"name":"–°–ê–û ‚Äî –ë–µ–≥–æ–≤–æ–π","lat":55.786,"lon":37.559,"value":37},
  {"name":"–°–ê–û ‚Äî –•–æ—Ä–æ—à–µ–≤—Å–∫–∏–π","lat":55.7771,"lon":37.5164,"value":31},
  {"name":"–°–ê–û ‚Äî –°–∞–≤–µ–ª–æ–≤—Å–∫–∏–π","lat":55.792,"lon":37.5885,"value":32},
  {"name":"–°–ê–û ‚Äî –¢–∏–º–∏—Ä—è–∑–µ–≤—Å–∫–∏–π","lat":55.8172,"lon":37.5688,"value":29},
  {"name":"–°–í–ê–û ‚Äî –ê–ª–µ–∫—Å–µ–µ–≤—Å–∫–∏–π","lat":55.8131,"lon":37.6443,"value":35},
  {"name":"–°–í–ê–û ‚Äî –ú–∞—Ä—å–∏–Ω–∞ —Ä–æ—â–∞","lat":55.7963,"lon":37.6168,"value":33},
  {"name":"–°–í–ê–û ‚Äî –û—Å—Ç–∞–Ω–∫–∏–Ω—Å–∫–∏–π","lat":55.8207,"lon":37.6003,"value":27},
  {"name":"–°–í–ê–û ‚Äî –ú–µ–¥–≤–µ–¥–∫–æ–≤–æ","lat":55.8646,"lon":37.6611,"value":24},
  {"name":"–í–ê–û ‚Äî –°–æ–∫–æ–ª—å–Ω–∏–∫–∏","lat":55.7924,"lon":37.6802,"value":34},
  {"name":"–í–ê–û ‚Äî –ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω—Å–∫–æ–µ","lat":55.7968,"lon":37.7283,"value":30},
  {"name":"–í–ê–û ‚Äî –ù–æ–≤–æ–≥–∏—Ä–µ–µ–≤–æ","lat":55.7511,"lon":37.8063,"value":26},
  {"name":"–í–ê–û ‚Äî –ò–∑–º–∞–π–ª–æ–≤–æ","lat":55.7867,"lon":37.799,"value":29},
  {"name":"–Æ–í–ê–û ‚Äî –¢–µ–∫—Å—Ç–∏–ª—å—â–∏–∫–∏","lat":55.7084,"lon":37.7421,"value":28},
  {"name":"–Æ–í–ê–û ‚Äî –†—è–∑–∞–Ω—Å–∫–∏–π","lat":55.718,"lon":37.7923,"value":27},
  {"name":"–Æ–í–ê–û ‚Äî –õ—é–±–ª–∏–Ω–æ","lat":55.6774,"lon":37.753,"value":25},
  {"name":"–Æ–í–ê–û ‚Äî –ö—É–∑—å–º–∏–Ω–∫–∏","lat":55.7051,"lon":37.7657,"value":26},
  {"name":"–Æ–ê–û ‚Äî –î–∞–Ω–∏–ª–æ–≤—Å–∫–∏–π","lat":55.705,"lon":37.6409,"value":31},
  {"name":"–Æ–ê–û ‚Äî –ù–∞–≥–∞—Ç–∏–Ω–æ","lat":55.6838,"lon":37.6487,"value":29},
  {"name":"–Æ–ê–û ‚Äî –ß–µ—Ä—Ç–∞–Ω–æ–≤–æ –°–µ–≤–µ—Ä–Ω–æ–µ","lat":55.6341,"lon":37.5867,"value":24},
  {"name":"–Æ–ê–û ‚Äî –ë–∏—Ä—é–ª–µ–≤–æ –í–æ—Å—Ç–æ—á–Ω–æ–µ","lat":55.5883,"lon":37.6618,"value":22},
  {"name":"–Æ–ó–ê–û ‚Äî –ì–∞–≥–∞—Ä–∏–Ω—Å–∫–∏–π","lat":55.6986,"lon":37.5432,"value":32},
  {"name":"–Æ–ó–ê–û ‚Äî –ö–æ–Ω—å–∫–æ–≤–æ","lat":55.6336,"lon":37.517,"value":30},
  {"name":"–Æ–ó–ê–û ‚Äî –¢–µ–ø–ª—ã–π —Å—Ç–∞–Ω","lat":55.6181,"lon":37.5054,"value":28},
  {"name":"–Æ–ó–ê–û ‚Äî –Ø—Å–µ–Ω–µ–≤–æ","lat":55.6058,"lon":37.5336,"value":27},
  {"name":"–ó–ê–û ‚Äî –§–∏–ª–µ–≤—Å–∫–∏–π –ø–∞—Ä–∫","lat":55.7398,"lon":37.497,"value":33},
  {"name":"–ó–ê–û ‚Äî –ö—É–Ω—Ü–µ–≤–æ","lat":55.7313,"lon":37.4352,"value":29},
  {"name":"–ó–ê–û ‚Äî –°–æ–ª–Ω—Ü–µ–≤–æ","lat":55.6524,"lon":37.4389,"value":26},
  {"name":"–ó–ê–û ‚Äî –í–Ω—É–∫–æ–≤–æ","lat":55.6067,"lon":37.2834,"value":23}
];

/* ========= –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ========= */

let allPlaces = ALL_PLACES.slice();
let brandLogos = BRAND_LOGOS;
let averageZones = AVERAGE_ZONES.slice();

let activeCategory = "all";
let activeTab = "cashback";
let heatMode = false;

let markersLayer = L.layerGroup();
let heatLayer = L.layerGroup();
let markerById = new Map();

let userPosition = null;
let userMarker = null;

let guidePlaces = [];
let currentStepIndex = 0;

/* ========= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ö–ê–†–¢–´ ========= */

const map = L.map("map").setView([55.75, 37.62], 11);

L.tileLayer(
  "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",
  { maxZoom: 19 }
).addTo(map);

markersLayer.addTo(map);

/* ========= –•–ï–õ–ü–ï–†–´ ========= */

function catColor(c) {
  switch (c) {
    case "–ê–ó–°": return "#ff3859";
    case "–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ": return "#ff9f30";
    case "–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã": return "#29d9a6";
    case "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è": return "#7c5cff";
    default: return "#ffffff";
  }
}

function haversine(a,b,c,d){
  const R=6371;
  const dLat=((c-a)*Math.PI)/180;
  const dLon=((d-b)*Math.PI)/180;
  const la=a*Math.PI/180;
  const lc=c*Math.PI/180;

  const h=Math.sin(dLat/2)**2 + Math.cos(la)*Math.cos(lc)*Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(h),Math.sqrt(1-h));
}

function distFmt(km){
  if(km<1) return Math.round(km*1000)+" –º";
  return km.toFixed(1)+" –∫–º";
}

/* ========= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø UI ========= */

const categoriesFilters = [
  {key:"all", label:"–í—Å–µ"},
  {key:"–ê–ó–°", label:"–ê–ó–°"},
  {key:"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ", label:"–†–µ—Å—Ç–æ—Ä–∞–Ω—ã"},
  {key:"–°–ø–æ—Ä—Ç—Ç–æ–≤–∞—Ä—ã", label:"–°–ø–æ—Ä—Ç"},
  {key:"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", label:"–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è"}
];

function initUI() {
  const tabsRow = document.querySelector(".tabs-row");

  // –≤–∫–ª–∞–¥–∫–∏
  tabsRow.querySelectorAll(".tab").forEach(tab => {
    tab.onclick = () => {
      activeTab = tab.getAttribute("data-tab");
      tabsRow.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      tab.classList.add("active");

      if (activeTab === "cashback") {
        hideNearbyList();
        exitHeatMode(); // –µ—Å–ª–∏ –±—ã–ª–∏ –≤ —Å—Ä–µ–¥–Ω–µ–º –∫—ç—à–±—ç–∫–µ
        showMainUI();
        rebuildMarkers();
        buildGuide();
      }

      if (activeTab === "nearby") {
        exitHeatMode();
        showNearbyList();
      }
    };
  });

  renderCategoryChips();

  // –ø–æ–∏—Å–∫
  document.getElementById("searchInput").addEventListener("input", () => {
    rebuildMarkers();
    buildGuide();
  });

  // –≥–µ–æ
  document.getElementById("btnLocate").onclick = () => locate();

  // –≥–∏–¥-–∫–∞—Ä—Ç–æ—á–∫–∞
  document.getElementById("guidePlaceCard").onclick = () => {
    const p = guidePlaces[currentStepIndex];
    if (!p) return;
    showDetail(p);
    map.flyTo([p.lat,p.lon],15,{duration:0.5});
  };

  // –∑–∞–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é
  document.getElementById("detailClose").onclick = hideDetail;

  // –±–∞–Ω–Ω–µ—Ä —Å—Ä–µ–¥–Ω–µ–≥–æ –∫—ç—à–±—ç–∫–∞
  document.getElementById("bannerRain").onclick = enterHeatMode;
  document.getElementById("heatBackBtn").onclick = exitHeatMode;

  // –Ω–∞–∑–∞–¥ –∏–∑ "–†—è–¥–æ–º —Å –≤–∞–º–∏"
  document.getElementById("nearbyBackBtn").onclick = () => {
    activeTab = "cashback";
    tabsRow.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    tabsRow.querySelector('[data-tab="cashback"]').classList.add("active");
    hideNearbyList();
    showMainUI();
    rebuildMarkers();
    buildGuide();
  };

  // —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  buildHeatLayer();
  rebuildMarkers();
  buildGuide();
}

/* ========= –ö–ê–¢–ï–ì–û–†–ò–ò ========= */

function renderCategoryChips() {
  const row = document.getElementById("categoriesRow");
  row.innerHTML = "";
  categoriesFilters.forEach(cf => {
    const chip = document.createElement("div");
    chip.className = "chip" + (activeCategory === cf.key ? " active" : "");
    const dot = document.createElement("div");
    dot.className = "chip-dot";
    dot.style.background = cf.key === "all" ? "#fff3" : catColor(cf.key);

    chip.appendChild(dot);
    chip.appendChild(document.createTextNode(cf.label));

    chip.onclick = () => {
      activeCategory = cf.key;
      renderCategoryChips();
      rebuildMarkers();
      buildGuide();
    };

    row.appendChild(chip);
  });
}

/* ========= –§–ò–õ–¨–¢–†–ê–¶–ò–Ø ========= */

function filterPlacesBasic() {
  const q = document.getElementById("searchInput").value.toLowerCase();
  return allPlaces.filter(p => {
    const okCat = activeCategory === "all" || p.category === activeCategory;
    const okQ = !q || p.name.toLowerCase().includes(q);
    return okCat && okQ;
  });
}

/* ========= –ú–ê–†–ö–ï–†–´ ========= */

function rebuildMarkers() {
  markersLayer.clearLayers();
  markerById.clear();

  if (heatMode) return;

  const filtered = filterPlacesBasic();
  filtered.forEach(createMarker);
}

function createMarker(p) {
  const icon = L.divIcon({
    html: `<div style="
      width:14px;height:14px;border-radius:999px;
      background:${catColor(p.category)};
      border:2px solid #05060a;
    "></div>`,
    className:"",
    iconSize:[16,16],
    iconAnchor:[8,8]
  });

  const m = L.marker([p.lat,p.lon],{icon}).addTo(markersLayer);
  markerById.set(p.id, m);

  m.on("click", () => {
    showDetail(p);
    map.flyTo([p.lat,p.lon],15,{duration:0.5});
  });
}

/*************** HEATMAP –ü–û –†–ê–ô–û–ù–ê–ú ***************/

function buildHeatLayer() {
  heatLayer.clearLayers();

  averageZones.forEach(z => {
    const color =
      z.value >= 35 ? "#ff3859" :
      z.value >= 25 ? "#ff9f30" : "#29d9a6";

    const circle = L.circle([z.lat,z.lon], {
      radius: 400 + z.value * 6,
      color,
      fillColor: color,
      fillOpacity: 0.18,
      weight: 1.2
    }).addTo(heatLayer);

    circle.bindPopup(`–°—Ä–µ–¥–Ω–∏–π –∫—ç—à–±—ç–∫: ${z.value} ‚ÇΩ`);
  });
}

function enterHeatMode() {
  if (heatMode) return;
  heatMode = true;

  map.addLayer(heatLayer);
  markersLayer.clearLayers();

  document.getElementById("mainUI").style.display = "none";
  document.getElementById("heatUI").style.display = "block";
}

function exitHeatMode() {
  if (!heatMode) {
    // –ø—Ä–æ—Å—Ç–æ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ UI –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ
    document.getElementById("heatUI").style.display = "none";
    document.getElementById("mainUI").style.display = "block";
    return;
  }
  heatMode = false;

  map.removeLayer(heatLayer);
  document.getElementById("heatUI").style.display = "none";
  document.getElementById("mainUI").style.display = "block";

  rebuildMarkers();
  buildGuide();
}

/*************** –ì–ò–î –ü–û –†–ê–ô–û–ù–£ (—Ç–æ–ª—å–∫–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã) ***************/

function buildGuide() {
  if (heatMode) return;

  const baseLat = userPosition ? userPosition.lat : 55.75;
  const baseLon = userPosition ? userPosition.lon : 37.62;

  const filtered = allPlaces
    .filter(p => p.category === "–†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ")
    .map(p => ({
      ...p,
      dist: haversine(baseLat, baseLon, p.lat, p.lon)
    }))
    .sort((a,b) => a.dist - b.dist);

  guidePlaces = filtered.slice(0, 5);
  currentStepIndex = 0;
  renderGuide();
}

function renderGuide() {
  const steps = document.getElementById("guideSteps");
  const titleEl = document.getElementById("guideTitle");
  const subtitleEl = document.getElementById("guideSubtitle");

  steps.innerHTML = "";

  if (!guidePlaces.length) {
    titleEl.textContent = "–ì–∏–¥ –ø–æ —Ä–∞–π–æ–Ω—É";
    subtitleEl.textContent =
      "–í–∫–ª—é—á–∏—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é, —á—Ç–æ–±—ã –º—ã –ø–æ–∫–∞–∑–∞–ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã —Ä—è–¥–æ–º —Å –≤–∞–º–∏.";
    document.getElementById("placeName").textContent = "";
    document.getElementById("placeAddress").textContent = "";
    document.getElementById("placeCategory").textContent = "";
    document.getElementById("placeDistance").textContent = "";
    document.getElementById("placeAvgCheck").textContent = "";
    return;
  }

  guidePlaces.forEach((p, i) => {
    const s = document.createElement("div");
    s.className = "step" + (i === currentStepIndex ? " active" : "");
    s.textContent = i + 1;
    s.onclick = () => {
      currentStepIndex = i;
      renderGuide();
      map.flyTo([p.lat, p.lon], 15, {duration:0.5});
      showDetail(p);
    };
    steps.appendChild(s);

    if (i < guidePlaces.length - 1) {
      const line = document.createElement("div");
      line.className = "step-line";
      steps.appendChild(line);
    }
  });

  const p = guidePlaces[currentStepIndex];

  titleEl.textContent = "–ì–∏–¥ –ø–æ —Ä–∞–π–æ–Ω—É";
  subtitleEl.textContent = `–®–∞–≥ ${currentStepIndex + 1} –∏–∑ ${guidePlaces.length}`;

  document.getElementById("placeName").textContent = p.name;
  document.getElementById("placeAddress").textContent = p.address;
  document.getElementById("placeCategory").textContent = p.category;
  document.getElementById("placeDistance").textContent = distFmt(p.dist);
  document.getElementById("placeAvgCheck").textContent = `~${p.avgCheck} ‚ÇΩ`;
}

function hideGuide() {
  const card = document.getElementById("guideCard");
  if (card) card.style.display = "none";
}

function showGuide() {
  const card = document.getElementById("guideCard");
  if (card) card.style.display = "block";
}

/*************** –°–ü–ò–°–û–ö ¬´–†–Ø–î–û–ú –° –í–ê–ú–ò¬ª (3 –ö–ú) ***************/

function showNearbyList() {
  hideGuide();

  const panel = document.getElementById("nearbyPanel");
  const listEl = document.getElementById("nearbyList");
  const searchRow = document.getElementById("searchRow");
  const catsRow = document.getElementById("categoriesRow");
  const banner = document.getElementById("bannerRain");
  const mainUI = document.getElementById("mainUI");

  panel.style.display = "block";
  if (searchRow) searchRow.style.display = "none";
  if (catsRow) catsRow.style.display = "none";
  if (banner) banner.style.display = "none";

  // —Ç–∞–±—ã –æ—Å—Ç–∞–≤–ª—è–µ–º, —á—Ç–æ–±—ã —é–∑–µ—Ä –ø–æ–Ω–∏–º–∞–ª, –≥–¥–µ –æ–Ω
  mainUI.style.display = "block";

  listEl.innerHTML = "";

  const baseLat = userPosition ? userPosition.lat : 55.75;
  const baseLon = userPosition ? userPosition.lon : 37.62;

  const withDist = allPlaces.map(p => ({
    ...p,
    dist: haversine(baseLat, baseLon, p.lat, p.lon)
  }));

  const nearby = withDist
    .filter(p => p.dist <= 3)
    .sort((a,b) => a.dist - b.dist);

  if (!nearby.length) {
    const empty = document.createElement("div");
    empty.style.fontSize = "13px";
    empty.style.color = "#c4c4d0";
    empty.style.paddingTop = "4px";
    empty.textContent = userPosition
      ? "–ú—ã –Ω–µ –Ω–∞—à–ª–∏ –º–µ—Å—Ç –≤ —Ä–∞–¥–∏—É—Å–µ 3 –∫–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –ø–æ –∫–∞—Ä—Ç–µ."
      : "–í–∫–ª—é—á–∏—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –º–µ—Å—Ç–∞ —Ä—è–¥–æ–º —Å –≤–∞–º–∏.";
    listEl.appendChild(empty);
    return;
  }

  nearby.forEach(p => {
    const item = document.createElement("div");
    item.className = "nearby-item";

    const logo = document.createElement("img");
    logo.className = "nearby-icon";
    logo.src = brandLogos[p.brand] || "logos/default.png";

    const textWrap = document.createElement("div");
    const nameEl = document.createElement("div");
    nameEl.className = "nearby-name";
    nameEl.textContent = p.name;

    const addrEl = document.createElement("div");
    addrEl.className = "nearby-address";
    addrEl.textContent = p.address;

    textWrap.appendChild(nameEl);
    textWrap.appendChild(addrEl);

    const distEl = document.createElement("div");
    distEl.className = "nearby-distance";
    distEl.textContent = distFmt(p.dist);

    item.appendChild(logo);
    item.appendChild(textWrap);
    item.appendChild(distEl);

    item.onclick = () => {
      showDetail(p);
      map.flyTo([p.lat, p.lon], 15, {duration:0.5});
    };

    listEl.appendChild(item);
  });
}

function hideNearbyList() {
  const panel = document.getElementById("nearbyPanel");
  const searchRow = document.getElementById("searchRow");
  const catsRow = document.getElementById("categoriesRow");
  const banner = document.getElementById("bannerRain");

  panel.style.display = "none";
  if (searchRow) searchRow.style.display = "flex";
  if (catsRow) catsRow.style.display = "flex";
  if (banner) banner.style.display = "flex";

  showGuide();
}

/*************** MAIN UI VISIBILITY ***************/

function showMainUI() {
  document.getElementById("mainUI").style.display = "block";
  document.getElementById("heatUI").style.display = "none";
}

/*************** –î–ï–¢–ê–õ–¨–ù–ê–Ø –ö–ê–†–¢–û–ß–ö–ê ***************/

function showDetail(p) {
  const wrap = document.getElementById("placeDetailWrap");
  const card = document.getElementById("placeDetail");

  const logoPath = brandLogos[p.brand] || "logos/default.png";

  document.getElementById("detailLogo").src = logoPath;
  document.getElementById("detailTitle").textContent = p.name;

  const catEl = document.getElementById("detailCategory");
  catEl.textContent = p.category;
  catEl.style.background = catColor(p.category);
  catEl.style.color = "#000";

  document.getElementById("detailAddress").textContent = p.address;
  document.getElementById("detailAvgCheck").textContent = p.avgCheck + " ‚ÇΩ";
  document.getElementById("detailCashback").textContent = p.cashback;

  wrap.style.display = "block";
  setTimeout(() => card.classList.add("show"), 10);
}

function hideDetail() {
  const wrap = document.getElementById("placeDetailWrap");
  const card = document.getElementById("placeDetail");
  card.classList.remove("show");
  setTimeout(() => (wrap.style.display = "none"), 200);
}

/*************** –ì–ï–û–õ–û–ö–ê–¶–ò–Ø ***************/

function locate() {
  if (!navigator.geolocation) {
    console.warn("Geolocation not supported");
    return;
  }
  navigator.geolocation.getCurrentPosition(pos => {
    userPosition = {
      lat: pos.coords.latitude,
      lon: pos.coords.longitude
    };

    if (!userMarker) {
      userMarker = L.circleMarker([userPosition.lat,userPosition.lon],{
        radius: 6,
        color: "#00ffb3",
        fillOpacity: 0.9
      }).addTo(map);
    } else {
      userMarker.setLatLng([userPosition.lat,userPosition.lon]);
    }

    map.setView([userPosition.lat,userPosition.lon], 13);

    // –æ–±–Ω–æ–≤–ª—è–µ–º –≥–∏–¥
    buildGuide();

    // –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç —ç–∫—Ä–∞–Ω "–†—è–¥–æ–º —Å –≤–∞–º–∏" ‚Äî –æ–±–Ω–æ–≤–∏–º —Å–ø–∏—Å–æ–∫
    if (activeTab === "nearby") {
      showNearbyList();
    }
  });
}

/* —Å—Ç–∞—Ä—Ç */
initUI();
</script>

</body>
</html>
